{"ast":null,"code":"import { CAS_URL } from '../config';\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';\nexport const login = () => {\n  // Check if we already have a token\n  const token = localStorage.getItem('token');\n  if (token) {\n    window.location.href = '/';\n    return;\n  }\n\n  // Get the current URL without any existing parameters\n  const currentUrl = window.location.origin + window.location.pathname;\n  const redirectUri = encodeURIComponent(currentUrl);\n  const serviceUrl = `${API_URL}/auth/cas/login?redirect_uri=${redirectUri}`;\n\n  // Redirect to CAS login, which will handle Duo Security\n  window.location.href = `${CAS_URL}/login?service=${encodeURIComponent(serviceUrl)}`;\n};\nexport const handleCasCallback = token => {\n  // Store the token\n  localStorage.setItem('token', token);\n\n  // Decode the JWT token to get user info\n  const payload = JSON.parse(atob(token.split('.')[1]));\n  localStorage.setItem('user_id', payload.sub);\n\n  // Get netid from additional claims\n  const netid = payload.netid;\n  localStorage.setItem('netid', netid);\n  return {\n    access_token: token,\n    user_id: payload.sub,\n    netid: netid\n  };\n};\nexport const logout = () => {\n  // Clear all stored data\n  localStorage.removeItem('token');\n  localStorage.removeItem('user_id');\n  localStorage.removeItem('netid');\n\n  // Redirect to login page\n  window.location.href = '/login';\n};\nexport const getToken = () => localStorage.getItem('token');\nexport const getUserId = () => localStorage.getItem('user_id');\nexport const getNetid = () => localStorage.getItem('netid');\nexport const isAuthenticated = () => {\n  const token = getToken();\n  return !!token;\n};\nexport const signup = async data => {\n  const response = await fetch(`${API_URL}/signup`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(data)\n  });\n  if (!response.ok) {\n    throw new Error('Signup failed');\n  }\n  return response.json();\n};","map":{"version":3,"names":["CAS_URL","API_URL","process","env","REACT_APP_API_URL","login","token","localStorage","getItem","window","location","href","currentUrl","origin","pathname","redirectUri","encodeURIComponent","serviceUrl","handleCasCallback","setItem","payload","JSON","parse","atob","split","sub","netid","access_token","user_id","logout","removeItem","getToken","getUserId","getNetid","isAuthenticated","signup","data","response","fetch","method","headers","body","stringify","ok","Error","json"],"sources":["/Users/angel/Documents/Princeton/COS 333/tigerpop.github.io/frontend/src/services/authService.ts"],"sourcesContent":["import axios from 'axios';\nimport { CAS_URL } from '../config';\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';\n\nexport interface LoginData {\n  username: string;\n  password: string;\n}\n\nexport interface SignupData {\n  username: string;\n  email: string;\n  password: string;\n}\n\nexport interface AuthResponse {\n  access_token: string;\n  user_id: number;\n  netid: string;\n}\n\nexport const login = () => {\n  // Check if we already have a token\n  const token = localStorage.getItem('token');\n  if (token) {\n    window.location.href = '/';\n    return;\n  }\n\n  // Get the current URL without any existing parameters\n  const currentUrl = window.location.origin + window.location.pathname;\n  const redirectUri = encodeURIComponent(currentUrl);\n  const serviceUrl = `${API_URL}/auth/cas/login?redirect_uri=${redirectUri}`;\n  \n  // Redirect to CAS login, which will handle Duo Security\n  window.location.href = `${CAS_URL}/login?service=${encodeURIComponent(serviceUrl)}`;\n};\n\nexport const handleCasCallback = (token: string): AuthResponse => {\n  // Store the token\n  localStorage.setItem('token', token);\n  \n  // Decode the JWT token to get user info\n  const payload = JSON.parse(atob(token.split('.')[1]));\n  localStorage.setItem('user_id', payload.sub);\n  \n  // Get netid from additional claims\n  const netid = payload.netid;\n  localStorage.setItem('netid', netid);\n  \n  return {\n    access_token: token,\n    user_id: payload.sub,\n    netid: netid\n  };\n};\n\nexport const logout = () => {\n  // Clear all stored data\n  localStorage.removeItem('token');\n  localStorage.removeItem('user_id');\n  localStorage.removeItem('netid');\n  \n  // Redirect to login page\n  window.location.href = '/login';\n};\n\nexport const getToken = () => localStorage.getItem('token');\n\nexport const getUserId = () => localStorage.getItem('user_id');\n\nexport const getNetid = () => localStorage.getItem('netid');\n\nexport const isAuthenticated = () => {\n  const token = getToken();\n  return !!token;\n};\n\nexport const signup = async (data: SignupData): Promise<{ message: string }> => {\n  const response = await fetch(`${API_URL}/signup`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(data),\n  });\n\n  if (!response.ok) {\n    throw new Error('Signup failed');\n  }\n\n  return response.json();\n}; "],"mappings":"AACA,SAASA,OAAO,QAAQ,WAAW;AAEnC,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,uBAAuB;AAmBxE,OAAO,MAAMC,KAAK,GAAGA,CAAA,KAAM;EACzB;EACA,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,IAAIF,KAAK,EAAE;IACTG,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,GAAG;IAC1B;EACF;;EAEA;EACA,MAAMC,UAAU,GAAGH,MAAM,CAACC,QAAQ,CAACG,MAAM,GAAGJ,MAAM,CAACC,QAAQ,CAACI,QAAQ;EACpE,MAAMC,WAAW,GAAGC,kBAAkB,CAACJ,UAAU,CAAC;EAClD,MAAMK,UAAU,GAAG,GAAGhB,OAAO,gCAAgCc,WAAW,EAAE;;EAE1E;EACAN,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,GAAGX,OAAO,kBAAkBgB,kBAAkB,CAACC,UAAU,CAAC,EAAE;AACrF,CAAC;AAED,OAAO,MAAMC,iBAAiB,GAAIZ,KAAa,IAAmB;EAChE;EACAC,YAAY,CAACY,OAAO,CAAC,OAAO,EAAEb,KAAK,CAAC;;EAEpC;EACA,MAAMc,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACjB,KAAK,CAACkB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACrDjB,YAAY,CAACY,OAAO,CAAC,SAAS,EAAEC,OAAO,CAACK,GAAG,CAAC;;EAE5C;EACA,MAAMC,KAAK,GAAGN,OAAO,CAACM,KAAK;EAC3BnB,YAAY,CAACY,OAAO,CAAC,OAAO,EAAEO,KAAK,CAAC;EAEpC,OAAO;IACLC,YAAY,EAAErB,KAAK;IACnBsB,OAAO,EAAER,OAAO,CAACK,GAAG;IACpBC,KAAK,EAAEA;EACT,CAAC;AACH,CAAC;AAED,OAAO,MAAMG,MAAM,GAAGA,CAAA,KAAM;EAC1B;EACAtB,YAAY,CAACuB,UAAU,CAAC,OAAO,CAAC;EAChCvB,YAAY,CAACuB,UAAU,CAAC,SAAS,CAAC;EAClCvB,YAAY,CAACuB,UAAU,CAAC,OAAO,CAAC;;EAEhC;EACArB,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;AACjC,CAAC;AAED,OAAO,MAAMoB,QAAQ,GAAGA,CAAA,KAAMxB,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;AAE3D,OAAO,MAAMwB,SAAS,GAAGA,CAAA,KAAMzB,YAAY,CAACC,OAAO,CAAC,SAAS,CAAC;AAE9D,OAAO,MAAMyB,QAAQ,GAAGA,CAAA,KAAM1B,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;AAE3D,OAAO,MAAM0B,eAAe,GAAGA,CAAA,KAAM;EACnC,MAAM5B,KAAK,GAAGyB,QAAQ,CAAC,CAAC;EACxB,OAAO,CAAC,CAACzB,KAAK;AAChB,CAAC;AAED,OAAO,MAAM6B,MAAM,GAAG,MAAOC,IAAgB,IAAmC;EAC9E,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGrC,OAAO,SAAS,EAAE;IAChDsC,MAAM,EAAE,MAAM;IACdC,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB,CAAC;IAC/CC,IAAI,EAAEpB,IAAI,CAACqB,SAAS,CAACN,IAAI;EAC3B,CAAC,CAAC;EAEF,IAAI,CAACC,QAAQ,CAACM,EAAE,EAAE;IAChB,MAAM,IAAIC,KAAK,CAAC,eAAe,CAAC;EAClC;EAEA,OAAOP,QAAQ,CAACQ,IAAI,CAAC,CAAC;AACxB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}